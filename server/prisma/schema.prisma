generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  PARENT
  DRIVER
}

enum Gender {
  MALE
  FEMALE
}

enum ActiveStatus {
  PENDING
  CANCELED
  ACTIVE
  SUCCESS
}

enum ActivePickupStatus {
  PENDING
  CANCELED
  DRIVING
  CONFIRMED
}

enum ActiveStudentStatus {
  PENDING
  ABSENT
  LEAVE
  CHECKED
}

enum InformType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum AccountStatus {
  ACTIVE
  INACTIVE
}

enum ScheduleStatus {
  ACTIVE
  INACTIVE
}

enum RouteStatus {
  ACTIVE
  INACTIVE
}

enum PickupStatus {
  ACTIVE
  INACTIVE
}

enum PickupCategory {
  SCHOOL
  PICKUP
}

enum BusStatus {
  ACTIVE
  INACTIVE
}

enum StudentStatus {
  STUDYING
  DROPPED_OUT
}

model accounts {
  id       Int           @id @default(autoincrement())
  username String        @unique
  password String
  role     Role          @default(PARENT)
  status   AccountStatus @default(ACTIVE)

  parents parents?
  drivers drivers?
}

model classes {
  id   Int    @id @default(autoincrement())
  name String

  students students[]
}

model actives {
  id         Int          @id @default(autoincrement())
  start_at   String
  end_at     String?
  bus_lat    Float?
  bus_lng    Float?
  bus_speed  Int?
  bus_status String?
  status     ActiveStatus @default(PENDING)

  schedule_id Int
  schedule    schedules @relation(fields: [schedule_id], references: [id])

  active_pickups  active_pickups[]
  active_students active_students[]
  informs         informs[]
}

model active_pickups {
  active_id Int
  pickup_id Int
  order     Int
  at        String?
  status    ActivePickupStatus @default(PENDING)

  active actives @relation(fields: [active_id], references: [id], onDelete: Cascade)
  pickup pickups @relation(fields: [pickup_id], references: [id], onDelete: Cascade)

  @@id([active_id, pickup_id])
}

model active_students {
  active_id  Int
  student_id Int
  at         String?
  status     ActiveStudentStatus @default(PENDING)

  active  actives  @relation(fields: [active_id], references: [id], onDelete: Cascade)
  student students @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@id([active_id, student_id])
}

model informs {
  id          Int        @id @default(autoincrement())
  at          String
  type        InformType @default(INFO)
  message     String
  description String

  active_id Int
  active    actives @relation(fields: [active_id], references: [id])
}

model schedules {
  id           Int            @id @default(autoincrement())
  start_date   String
  end_date     String
  start_time   String
  end_time     String
  days_of_week String
  status       ScheduleStatus @default(ACTIVE)

  driver_id Int
  driver    drivers @relation(fields: [driver_id], references: [id])

  bus_id Int
  bus    buses @relation(fields: [bus_id], references: [id])

  route_id Int
  route    routes @relation(fields: [route_id], references: [id])

  actives actives[]
}

model routes {
  id             Int         @id @default(autoincrement())
  name           String
  start_pickup   String
  end_pickup     String
  total_distance Int
  total_time     Int
  status         RouteStatus @default(ACTIVE)

  schedules    schedules[]
  routePickups route_pickups[]
}

model pickups {
  id       Int            @id @default(autoincrement())
  name     String
  category PickupCategory
  lat      Float
  lng      Float
  status   PickupStatus   @default(ACTIVE)

  routes        route_pickups[]
  students      students[]
  activePickups active_pickups[]
}

model route_pickups {
  route_id  Int
  pickup_id Int
  order     Int
  route     routes  @relation(fields: [route_id], references: [id], onDelete: Cascade)
  pickup    pickups @relation(fields: [pickup_id], references: [id], onDelete: Cascade)

  @@id([route_id, pickup_id])
}

model buses {
  id            Int       @id @default(autoincrement())
  license_plate String    @unique
  capacity      Int
  status        BusStatus @default(ACTIVE)

  schedule schedules[]
}

model drivers {
  id         Int     @id @default(autoincrement())
  avatar     String?
  full_name  String
  birth_date String
  gender     Gender  @default(MALE)
  phone      String  @unique
  email      String? @unique
  address    String?

  schedule schedules[]

  account_id Int      @unique
  account    accounts @relation(fields: [account_id], references: [id])
}

model parents {
  id        Int     @id @default(autoincrement())
  avatar    String?
  full_name String
  phone     String  @unique
  email     String? @unique
  address   String?

  students students[]

  account_id Int      @unique
  account    accounts @relation(fields: [account_id], references: [id])
}

model students {
  id         Int           @id @default(autoincrement())
  avatar     String?
  card_id    String?
  full_name  String
  birth_date String
  gender     Gender        @default(MALE)
  address    String
  status     StudentStatus @default(STUDYING)

  parent_id Int
  parent    parents @relation(fields: [parent_id], references: [id])

  class_id Int
  class    classes @relation(fields: [class_id], references: [id])

  pickup_id      Int
  pickup         pickups           @relation(fields: [pickup_id], references: [id])
  activeStudents active_students[]
}
